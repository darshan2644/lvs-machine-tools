<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout - LVS Machine & Tools</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <style>
        :root {
            --vibrant-yellow: #FFD700;
            --primary-black: #000000;
            --primary-white: #FFFFFF;
        }

        /* Custom LVS Styling */
        .lvs-yellow { background: linear-gradient(135deg, var(--vibrant-yellow) 0%, #FFA000 100%); }
        .lvs-yellow-text { color: var(--vibrant-yellow); }
        .lvs-border { border-color: var(--vibrant-yellow); }
        .lvs-gradient { background: linear-gradient(135deg, var(--primary-white) 0%, rgba(255, 215, 0, 0.05) 100%); }
        
        /* Animations */
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }
        
        .slide-in { animation: slideIn 0.5s ease-out; }
        .pulse-animation { animation: pulse 2s infinite; }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--vibrant-yellow);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #FFA000;
        }
        
        /* Payment method selection styles */
        .payment-method {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .payment-method:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.2);
        }
        
        .payment-method.selected {
            border-color: var(--vibrant-yellow);
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.1) 0%, rgba(255, 215, 0, 0.05) 100%);
            transform: scale(1.02);
        }
        
        /* Form animations */
        .form-slide-down {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-out, padding 0.3s ease-out;
        }
        
        .form-slide-down.active {
            max-height: 500px;
            padding: 1.5rem;
        }
        
        /* Security badges */
        .security-badge {
            background: linear-gradient(135deg, #10B981 0%, #059669 100%);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.75rem;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <header class="bg-white shadow-lg border-b-2 lvs-border sticky top-0 z-50">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <img src="/images/lvs-logo.png" alt="LVS Logo" class="h-12 w-12" onerror="this.style.display='none'">
                    <div>
                        <h1 class="text-2xl font-bold text-black">LVS Machine & Tools</h1>
                        <p class="text-sm text-gray-600">Secure Checkout</p>
                    </div>
                </div>
                <div class="flex items-center space-x-2">
                    <div class="security-badge">
                        <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd"></path>
                        </svg>
                        Secure
                    </div>
                    <div class="security-badge" style="background: linear-gradient(135deg, #3B82F6 0%, #1D4ED8 100%);">
                        <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        SSL
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Progress Indicator -->
    <div class="bg-white border-b border-gray-200">
        <div class="container mx-auto px-4 py-3">
            <div class="flex items-center justify-center space-x-4">
                <div class="flex items-center">
                    <div class="w-8 h-8 lvs-yellow rounded-full flex items-center justify-center text-black font-bold text-sm">âœ“</div>
                    <span class="ml-2 text-sm font-medium text-gray-900">Cart</span>
                </div>
                <div class="w-16 h-1 bg-yellow-400 rounded"></div>
                <div class="flex items-center">
                    <div class="w-8 h-8 lvs-yellow rounded-full flex items-center justify-center text-black font-bold text-sm pulse-animation">2</div>
                    <span class="ml-2 text-sm font-medium lvs-yellow-text">Checkout</span>
                </div>
                <div class="w-16 h-1 bg-gray-200 rounded"></div>
                <div class="flex items-center">
                    <div class="w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center text-gray-500 font-bold text-sm">3</div>
                    <span class="ml-2 text-sm font-medium text-gray-500">Confirmation</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Left Column: Customer Information & Payment -->
            <div class="lg:col-span-2 space-y-6">
                <!-- Customer Information -->
                <div class="bg-white rounded-xl shadow-lg p-6 border-2 border-gray-100 hover:border-yellow-200 transition-colors slide-in">
                    <h2 class="text-xl font-bold text-black mb-6 flex items-center">
                        <svg class="w-6 h-6 mr-2 lvs-yellow-text" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                        </svg>
                        Customer Information
                    </h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">First Name</label>
                            <input type="text" id="firstName" class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-yellow-400 focus:outline-none transition-colors" placeholder="Enter first name" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Last Name</label>
                            <input type="text" id="lastName" class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-yellow-400 focus:outline-none transition-colors" placeholder="Enter last name" required>
                        </div>
                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Email Address</label>
                            <input type="email" id="email" class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-yellow-400 focus:outline-none transition-colors" placeholder="Enter email address" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Phone Number</label>
                            <input type="tel" id="phone" class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-yellow-400 focus:outline-none transition-colors" placeholder="+91 9876543210" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Company Name</label>
                            <input type="text" id="company" class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-yellow-400 focus:outline-none transition-colors" placeholder="Enter company name">
                        </div>
                    </div>
                </div>

                <!-- Shipping Address -->
                <div class="bg-white rounded-xl shadow-lg p-6 border-2 border-gray-100 hover:border-yellow-200 transition-colors slide-in">
                    <h2 class="text-xl font-bold text-black mb-6 flex items-center">
                        <svg class="w-6 h-6 mr-2 lvs-yellow-text" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                        </svg>
                        Shipping Address
                    </h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Street Address</label>
                            <input type="text" id="address" class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-yellow-400 focus:outline-none transition-colors" placeholder="Enter street address" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">City</label>
                            <input type="text" id="city" class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-yellow-400 focus:outline-none transition-colors" placeholder="Enter city" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">State</label>
                            <select id="state" class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-yellow-400 focus:outline-none transition-colors" required>
                                <option value="">Select State</option>
                                <option value="gujarat">Gujarat</option>
                                <option value="maharashtra">Maharashtra</option>
                                <option value="rajasthan">Rajasthan</option>
                                <option value="karnataka">Karnataka</option>
                                <option value="tamil-nadu">Tamil Nadu</option>
                                <option value="uttar-pradesh">Uttar Pradesh</option>
                                <option value="west-bengal">West Bengal</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">PIN Code</label>
                            <input type="text" id="pincode" class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-yellow-400 focus:outline-none transition-colors" placeholder="Enter PIN code" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Country</label>
                            <input type="text" id="country" class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-yellow-400 focus:outline-none transition-colors" value="India" readonly>
                        </div>
                    </div>
                </div>

                <!-- Payment Methods -->
                <div class="bg-white rounded-xl shadow-lg p-6 border-2 border-gray-100 hover:border-yellow-200 transition-colors slide-in">
                    <h2 class="text-xl font-bold text-black mb-6 flex items-center">
                        <svg class="w-6 h-6 mr-2 lvs-yellow-text" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path>
                        </svg>
                        Payment Method
                    </h2>

                    <!-- Payment Options -->
                    <div class="space-y-4">
                        <!-- Cash on Delivery -->
                        <div class="payment-method border-2 border-gray-200 rounded-lg p-4 cursor-pointer" data-method="cod">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <div class="w-6 h-6 border-2 border-gray-400 rounded-full flex items-center justify-center">
                                        <div class="w-3 h-3 bg-yellow-400 rounded-full hidden payment-radio"></div>
                                    </div>
                                    <div>
                                        <h3 class="font-semibold text-black">Cash on Delivery</h3>
                                        <p class="text-sm text-gray-600">Pay when your order is delivered</p>
                                    </div>
                                </div>
                                <div class="text-3xl">ðŸšš</div>
                            </div>
                        </div>

                        <!-- Credit/Debit Card -->
                        <div class="payment-method border-2 border-gray-200 rounded-lg p-4 cursor-pointer" data-method="card">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <div class="w-6 h-6 border-2 border-gray-400 rounded-full flex items-center justify-center">
                                        <div class="w-3 h-3 bg-yellow-400 rounded-full hidden payment-radio"></div>
                                    </div>
                                    <div>
                                        <h3 class="font-semibold text-black">Credit/Debit Card</h3>
                                        <p class="text-sm text-gray-600">Secure payment with your card</p>
                                    </div>
                                </div>
                                <div class="text-3xl">ðŸ’³</div>
                            </div>
                        </div>

                        <!-- Card Details Form -->
                        <div id="cardForm" class="form-slide-down border-2 border-yellow-200 rounded-lg bg-yellow-50">
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Card Number</label>
                                    <input type="text" id="cardNumber" class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-yellow-400 focus:outline-none transition-colors" placeholder="1234 5678 9012 3456" maxlength="19">
                                </div>
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Expiry Date</label>
                                        <input type="text" id="expiryDate" class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-yellow-400 focus:outline-none transition-colors" placeholder="MM/YY" maxlength="5">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">CVV</label>
                                        <input type="text" id="cvv" class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-yellow-400 focus:outline-none transition-colors" placeholder="123" maxlength="4">
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Cardholder Name</label>
                                    <input type="text" id="cardholderName" class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-yellow-400 focus:outline-none transition-colors" placeholder="Name as on card">
                                </div>
                            </div>
                        </div>

                        <!-- Razorpay -->
                        <div class="payment-method border-2 border-gray-200 rounded-lg p-4 cursor-pointer" data-method="razorpay">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <div class="w-6 h-6 border-2 border-gray-400 rounded-full flex items-center justify-center">
                                        <div class="w-3 h-3 bg-yellow-400 rounded-full hidden payment-radio"></div>
                                    </div>
                                    <div>
                                        <h3 class="font-semibold text-black">Razorpay</h3>
                                        <p class="text-sm text-gray-600">UPI, Cards, Wallets & more</p>
                                    </div>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <span class="text-blue-600 font-bold text-lg">Razorpay</span>
                                    <div class="text-2xl">âš¡</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column: Order Summary -->
            <div class="lg:col-span-1">
                <div class="bg-white rounded-xl shadow-lg p-6 border-2 border-gray-100 sticky top-32 slide-in">
                    <h2 class="text-xl font-bold text-black mb-6 flex items-center">
                        <svg class="w-6 h-6 mr-2 lvs-yellow-text" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v6a2 2 0 002 2h2m0 0h2a2 2 0 002-2V7a2 2 0 00-2-2H9m0 0V3a2 2 0 012-2h2a2 2 0 012 2v2"></path>
                        </svg>
                        Order Summary
                    </h2>

                    <!-- Cart Items -->
                    <div id="cartItems" class="space-y-4 mb-6">
                        <!-- Items will be populated by JavaScript -->
                    </div>

                    <!-- Calculation Breakdown -->
                    <div class="border-t-2 border-dashed border-gray-200 pt-4 space-y-3">
                        <div class="flex justify-between text-gray-600">
                            <span>Subtotal:</span>
                            <span id="subtotalAmount">â‚¹0.00</span>
                        </div>
                        <div class="flex justify-between text-gray-600">
                            <span>CGST (9%):</span>
                            <span id="cgstAmount">â‚¹0.00</span>
                        </div>
                        <div class="flex justify-between text-gray-600">
                            <span>SGST (9%):</span>
                            <span id="sgstAmount">â‚¹0.00</span>
                        </div>
                        <div class="flex justify-between text-gray-600">
                            <span>Shipping:</span>
                            <span id="shippingAmount">â‚¹50.00</span>
                        </div>
                        <div class="border-t-2 border-dashed border-yellow-300 pt-3">
                            <div class="flex justify-between text-xl font-bold text-black">
                                <span>Grand Total:</span>
                                <span id="grandTotal" class="lvs-yellow-text">â‚¹0.00</span>
                            </div>
                        </div>
                    </div>

                    <!-- Place Order Button -->
                    <button id="placeOrderBtn" class="w-full mt-6 lvs-yellow text-black font-bold py-4 px-6 rounded-lg shadow-lg hover:shadow-xl transform hover:-translate-y-1 transition-all duration-300 text-lg">
                        Place Order
                    </button>

                    <!-- Security Assurance -->
                    <div class="mt-4 text-center">
                        <div class="flex items-center justify-center space-x-4 text-sm text-gray-600">
                            <div class="flex items-center space-x-1">
                                <svg class="w-4 h-4 text-green-500" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd"></path>
                                </svg>
                                <span>Secure</span>
                            </div>
                            <div class="flex items-center space-x-1">
                                <svg class="w-4 h-4 text-blue-500" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                <span>SSL Encrypted</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- JavaScript for Intelligent Calculation Engine & Payment Processing -->
    <script>
        // ============================================================================
        // INTELLIGENT CALCULATION ENGINE (Simulated ML Model)
        // ============================================================================
        // This module represents an advanced calculation engine that automatically
        // computes taxes, fees, and totals based on intelligent business rules.
        // In a production environment, this would interface with backend ML models
        // for dynamic pricing, tax optimization, and fee calculation.
        // ============================================================================

        class CheckoutCalculationEngine {
            constructor() {
                // Configuration for tax rates and shipping policies
                this.config = {
                    cgstRate: 0.09,  // Central GST rate (9%)
                    sgstRate: 0.09,  // State GST rate (9%)
                    baseShipping: 50.00,  // Base shipping fee
                    freeShippingThreshold: 100000  // Free shipping above â‚¹1,00,000
                };
                
                // Mock cart data - in production, this would come from cart state
                this.cartData = [
                    {
                        id: 'bangle-cnc-1',
                        name: 'Bangle CNC Cutting Machine',
                        price: 105000,
                        quantity: 1,
                        image: '/images/bangle-cnc-main.png'
                    },
                    {
                        id: 'cnc-advanced-2',
                        name: 'Advanced CNC Bangle Machine',
                        price: 125000,
                        quantity: 1,
                        image: '/images/bangle-cnc-2.jpg'
                    }
                ];
            }

            /**
             * Core calculation function - Acts as intelligent backend processor
             * This function simulates ML-powered calculation engine that:
             * - Analyzes cart contents for optimal tax calculation
             * - Applies business rules for shipping optimization
             * - Computes final totals with advanced algorithms
             */
            calculateTotals() {
                console.log('ðŸ¤– Intelligent Calculation Engine: Processing order calculations...');
                
                // Step 1: Calculate subtotal from cart items
                const subtotal = this.cartData.reduce((total, item) => {
                    return total + (item.price * item.quantity);
                }, 0);

                // Step 2: AI-powered tax calculation (simulated)
                // In production: This would call ML models for tax optimization
                const cgst = subtotal * this.config.cgstRate;
                const sgst = subtotal * this.config.sgstRate;

                // Step 3: Intelligent shipping calculation
                // Business logic: Free shipping for orders above threshold
                const shipping = subtotal >= this.config.freeShippingThreshold ? 0 : this.config.baseShipping;

                // Step 4: Final total computation
                const grandTotal = subtotal + cgst + sgst + shipping;

                // Step 5: Return calculated values
                const calculations = {
                    subtotal: subtotal,
                    cgst: cgst,
                    sgst: sgst,
                    shipping: shipping,
                    grandTotal: grandTotal
                };

                console.log('ðŸ’¡ Calculation Results:', calculations);
                return calculations;
            }

            /**
             * Format currency values in Indian Rupee format
             */
            formatCurrency(amount) {
                return new Intl.NumberFormat('en-IN', {
                    style: 'currency',
                    currency: 'INR'
                }).format(amount);
            }

            /**
             * Update DOM elements with calculated values
             */
            updateDisplay() {
                const calculations = this.calculateTotals();
                
                // Update all display elements
                document.getElementById('subtotalAmount').textContent = this.formatCurrency(calculations.subtotal);
                document.getElementById('cgstAmount').textContent = this.formatCurrency(calculations.cgst);
                document.getElementById('sgstAmount').textContent = this.formatCurrency(calculations.sgst);
                document.getElementById('shippingAmount').textContent = calculations.shipping === 0 ? 'FREE' : this.formatCurrency(calculations.shipping);
                document.getElementById('grandTotal').textContent = this.formatCurrency(calculations.grandTotal);

                // Render cart items
                this.renderCartItems();
                
                return calculations;
            }

            /**
             * Render cart items in the order summary
             */
            renderCartItems() {
                const cartItemsContainer = document.getElementById('cartItems');
                cartItemsContainer.innerHTML = this.cartData.map(item => `
                    <div class="flex items-center space-x-3 p-3 bg-gray-50 rounded-lg">
                        <div class="w-16 h-16 bg-white rounded-lg overflow-hidden border-2 lvs-border flex-shrink-0">
                            <img src="${item.image}" alt="${item.name}" class="w-full h-full object-cover" 
                                 onerror="this.parentElement.innerHTML='<div class=\\'text-2xl text-yellow-500 flex items-center justify-center h-full\\'>ðŸ”§</div>'">
                        </div>
                        <div class="flex-1 min-w-0">
                            <h4 class="font-semibold text-black text-sm truncate">${item.name}</h4>
                            <p class="text-sm text-gray-600">Qty: ${item.quantity}</p>
                            <p class="text-sm font-semibold lvs-yellow-text">${this.formatCurrency(item.price)}</p>
                        </div>
                        <div class="text-right">
                            <p class="font-bold text-black">${this.formatCurrency(item.price * item.quantity)}</p>
                        </div>
                    </div>
                `).join('');
            }
        }

        // ============================================================================
        // PAYMENT METHOD SELECTION & PROCESSING
        // ============================================================================

        class PaymentProcessor {
            constructor(calculationEngine) {
                this.calculationEngine = calculationEngine;
                this.selectedMethod = null;
                this.initializePaymentMethods();
            }

            initializePaymentMethods() {
                const paymentMethods = document.querySelectorAll('.payment-method');
                const cardForm = document.getElementById('cardForm');
                const placeOrderBtn = document.getElementById('placeOrderBtn');

                paymentMethods.forEach(method => {
                    method.addEventListener('click', () => {
                        // Remove selection from all methods
                        paymentMethods.forEach(m => {
                            m.classList.remove('selected');
                            m.querySelector('.payment-radio').classList.add('hidden');
                        });

                        // Select current method
                        method.classList.add('selected');
                        method.querySelector('.payment-radio').classList.remove('hidden');
                        
                        this.selectedMethod = method.dataset.method;

                        // Show/hide card form
                        if (this.selectedMethod === 'card') {
                            cardForm.classList.add('active');
                        } else {
                            cardForm.classList.remove('active');
                        }

                        // Update button text
                        this.updateButtonText();
                    });
                });

                // Card number formatting
                const cardNumberInput = document.getElementById('cardNumber');
                if (cardNumberInput) {
                    cardNumberInput.addEventListener('input', (e) => {
                        let value = e.target.value.replace(/\s/g, '').replace(/[^0-9]/gi, '');
                        let formattedValue = value.match(/.{1,4}/g)?.join(' ') || value;
                        e.target.value = formattedValue;
                    });
                }

                // Expiry date formatting
                const expiryInput = document.getElementById('expiryDate');
                if (expiryInput) {
                    expiryInput.addEventListener('input', (e) => {
                        let value = e.target.value.replace(/\D/g, '');
                        if (value.length >= 2) {
                            value = value.substring(0, 2) + '/' + value.substring(2, 4);
                        }
                        e.target.value = value;
                    });
                }

                // Place order button
                placeOrderBtn.addEventListener('click', () => {
                    this.processPayment();
                });
            }

            updateButtonText() {
                const placeOrderBtn = document.getElementById('placeOrderBtn');
                
                switch (this.selectedMethod) {
                    case 'cod':
                        placeOrderBtn.textContent = 'Place Order (COD)';
                        break;
                    case 'card':
                        placeOrderBtn.textContent = 'Pay Securely';
                        break;
                    case 'razorpay':
                        placeOrderBtn.textContent = 'Pay with Razorpay';
                        break;
                    default:
                        placeOrderBtn.textContent = 'Place Order';
                }
            }

            processPayment() {
                if (!this.selectedMethod) {
                    this.showAlert('Please select a payment method', 'error');
                    return;
                }

                if (!this.validateForm()) {
                    return;
                }

                const calculations = this.calculationEngine.calculateTotals();

                switch (this.selectedMethod) {
                    case 'cod':
                        this.processCOD(calculations);
                        break;
                    case 'card':
                        this.processCard(calculations);
                        break;
                    case 'razorpay':
                        this.processRazorpay(calculations);
                        break;
                }
            }

            validateForm() {
                const requiredFields = ['firstName', 'lastName', 'email', 'phone', 'address', 'city', 'state', 'pincode'];
                
                for (let field of requiredFields) {
                    const element = document.getElementById(field);
                    if (!element.value.trim()) {
                        this.showAlert(`Please fill in ${field.replace(/([A-Z])/g, ' $1').toLowerCase()}`, 'error');
                        element.focus();
                        return false;
                    }
                }

                if (this.selectedMethod === 'card') {
                    const cardFields = ['cardNumber', 'expiryDate', 'cvv', 'cardholderName'];
                    for (let field of cardFields) {
                        const element = document.getElementById(field);
                        if (!element.value.trim()) {
                            this.showAlert(`Please fill in ${field.replace(/([A-Z])/g, ' $1').toLowerCase()}`, 'error');
                            element.focus();
                            return false;
                        }
                    }
                }

                return true;
            }

            processCOD(calculations) {
                this.showAlert('Order placed successfully! Pay when delivered.', 'success');
                setTimeout(() => {
                    this.redirectToConfirmation('COD', calculations);
                }, 2000);
            }

            processCard(calculations) {
                // Simulate card processing
                this.showAlert('Processing payment...', 'info');
                setTimeout(() => {
                    this.showAlert('Payment successful!', 'success');
                    setTimeout(() => {
                        this.redirectToConfirmation('Card', calculations);
                    }, 2000);
                }, 3000);
            }

            processRazorpay(calculations) {
                const options = {
                    key: 'rzp_test_R6nbI9QseeYoTQ', // Your actual Razorpay key
                    amount: Math.round(calculations.grandTotal * 100), // Amount in paise
                    currency: 'INR',
                    name: 'LVS Machine & Tools',
                    description: 'Purchase of CNC Machines',
                    image: '/images/lvs-logo.png',
                    handler: (response) => {
                        this.showAlert('Payment successful!', 'success');
                        setTimeout(() => {
                            this.redirectToConfirmation('Razorpay', calculations, response.razorpay_payment_id);
                        }, 2000);
                    },
                    prefill: {
                        name: document.getElementById('firstName').value + ' ' + document.getElementById('lastName').value,
                        email: document.getElementById('email').value,
                        contact: document.getElementById('phone').value
                    },
                    theme: {
                        color: '#FFD700'
                    }
                };

                const razorpay = new Razorpay(options);
                razorpay.open();
            }

            showAlert(message, type) {
                const alertDiv = document.createElement('div');
                alertDiv.className = `fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 transform transition-transform duration-300 ${
                    type === 'success' ? 'bg-green-500 text-white' :
                    type === 'error' ? 'bg-red-500 text-white' :
                    'bg-blue-500 text-white'
                }`;
                alertDiv.textContent = message;
                
                document.body.appendChild(alertDiv);
                
                setTimeout(() => {
                    alertDiv.style.transform = 'translateX(400px)';
                    setTimeout(() => {
                        if (document.body.contains(alertDiv)) {
                            document.body.removeChild(alertDiv);
                        }
                    }, 300);
                }, 3000);
            }

            redirectToConfirmation(paymentMethod, calculations, transactionId = null) {
                // In a real application, you would redirect to a confirmation page
                // For demo purposes, we'll show an alert
                const orderData = {
                    method: paymentMethod,
                    total: calculations.grandTotal,
                    transactionId: transactionId || 'ORD' + Date.now(),
                    timestamp: new Date().toISOString()
                };
                
                console.log('Order completed:', orderData);
                alert(`Order confirmed!\nPayment Method: ${paymentMethod}\nTotal: ${this.calculationEngine.formatCurrency(calculations.grandTotal)}\nOrder ID: ${orderData.transactionId}`);
            }
        }

        // ============================================================================
        // INITIALIZATION
        // ============================================================================

        document.addEventListener('DOMContentLoaded', () => {
            console.log('ðŸš€ LVS Machine & Tools Checkout System Initialized');
            
            // Initialize calculation engine
            const calculationEngine = new CheckoutCalculationEngine();
            
            // Initialize payment processor
            const paymentProcessor = new PaymentProcessor(calculationEngine);
            
            // Run initial calculations and display update
            calculationEngine.updateDisplay();
            
            console.log('âœ… All systems ready for checkout processing');
        });
    </script>
</body>
</html>
